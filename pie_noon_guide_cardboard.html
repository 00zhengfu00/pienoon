<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Pie Noon: Cardboard</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,700" rel="stylesheet">
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Pie Noon
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pie_noon_guide_gameplay.html"><span>Gameplay</span></a></li>
      <li><a href="pie_noon_guide_overview.html"><span>Programmer's&#160;Guide</span></a></li>
      <li><a href="pie_noon_readme.html"><span>Readme</span></a></li>
      <li><a href="contributing.html"><span>Contributing</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('pie_noon_guide_cardboard.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Cardboard </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="cardboard_introduction"></a>
Introduction</h1>
<p>This document outlines how the <a href="https://developers.google.com/cardboard/android/">Cardboard SDK for Android</a> is used in Pie Noon, with specific regard to working with SDL. For additional tips on designing for Cardboard, be sure to check out <a href="http://www.google.com/design/spec-vr/designing-for-google-cardboard/a-new-dimension.html">Designing for Google Cardboard</a>.</p>
<h1><a class="anchor" id="cardboard_overview"></a>
Overview</h1>
<p>The Cardboard SDK provides various interfaces and classes to handle the information that is needed to work with a Cardboard device, like head tracking and detecting the magnet switch input. As the Cardboard SDK is a Java library, you can see these being used in FPLActivity.java. Java Native Interface (JNI) is used in order to interact with those objects from the C++ code base.</p>
<h1><a class="anchor" id="cardboard_input"></a>
Input</h1>
<p>Similar to other input devices, a <a class="el" href="pie_noon_guide_controllers.html">Controller</a> is used to abstract input from the Cardboard (<a class="el" href="cardboard__controller_8h_source.html">cardboard_controller.h</a>/.cpp). In addition, the InputSystem class (<a class="el" href="input_8h_source.html">input.h</a>/.cpp) has a <b>CardboardInput</b> object, which is captures events sent from the Java SDK, and provides functions to interact with it from the C++ code base. You can reach this with the function <b>cardboard_input()</b>, on the InputSystem class.</p>
<p>Head tracking is managed through the CardboardInput. Every frame it updates the two matrices it has for both eyes by calling, through JNI, <b>getCurrentEyeParams()</b> on <a href="https://developers.google.com/cardboard/android/latest/reference/com/google/vrtoolkit/cardboard/CardboardView">CardboardView</a>. These matrices can then be reached with <b>left/right_eye_transform()</b>, on the CardboardInput object, and are used when rendering for Cardboard, as they reflect the direction the device is oriented towards.</p>
<p>Receiving input from the magnet switch is handled first in FPLActivity.java, by the <b>MagnetSensor</b>, and the implemention of the <b>OnCardboardTriggerListener</b> interface. When the device detects the magnet switch, a call is passed from that to <b>CardboardInput</b>. Then, to determine if it was triggered in that frame, you can check the <b>triggered()</b> function. This is used by the cardboard controller, which when a trigger is detected, converts it to the correct logical inputs (Select Menu Option and Throw Pies). Also in InputSystem, it checks for presses on the touchpad, which are also translates as Cardboard triggers. This is important, as not all Cardboard devices use the magnet switch to handle input, and instead rely on touch.</p>
<h1><a class="anchor" id="cardboard_rendering"></a>
Rendering</h1>
<p>Rendering for Cardboard has to be handled, as the view needs to be duplicated for the left and right eye. Along with that, the Cardboard SDK provides the function <b>undistortTexture()</b> in <a href="https://developers.google.com/cardboard/android/latest/reference/com/google/vrtoolkit/cardboard/CardboardView">CardboardView</a>, which undistorts the given texture, adjusting the image to make it look correct for cardboard.</p>
<p>Because of how Cardboard works, the game needs to be rendered from two, slightly different viewpoints, for the left and right eyes. This is handled in <a class="el" href="pie__noon__game_8h_source.html">pie_noon_game.h</a>/.cpp's <b>RenderForCardboard()</b>. In that function, we split the viewport in half, adjust the camera with the corresponding transform from the <b>CardboardInput</b>, and render the scene for each view.</p>
<p>To use the undistort effects, some additional set up is required, which wraps the split rendering. The renderer class (<a class="el" href="renderer_8h_source.html">renderer.h</a>/.cpp) provides two functions which are used, <b>BeginUndistortFramebuffer()</b> and <b>FinishUndistortFramebuffer()</b>. The first sets up a framebuffer that will be rendered to, while that second takes that framebuffer modifies and renders it to the device, with the Cardboard SDK. These calls should wrap any rendering that is meant to be seen with both eyes.</p>
<p>Additional rendering can be done outside of these calls to render on the device as normal. This can be seen with the <b>RenderCardboardCenteringBar()</b> function, which displays a bar in the center of the screen, letting players align the game correctly.</p>
<p><br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-49880327-7', 'google.github.io');
ga('send', 'pageview');
</script>
</body>
</html>
