<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Pie Noon: GPGMultiplayer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,700" rel="stylesheet">
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Pie Noon
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pie_noon_guide_gameplay.html"><span>Gameplay</span></a></li>
      <li><a href="pie_noon_guide_overview.html"><span>Programmer's&#160;Guide</span></a></li>
      <li><a href="pie_noon_readme.html"><span>Readme</span></a></li>
      <li><a href="contributing.html"><span>Contributing</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('pie_noon_guide_gpg_multiplayer.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">GPGMultiplayer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Introduction</h2>
<p>GPGMultiplayer is a wrapper around the <a href="https://developers.google.com/games/services/android/nearby">Nearby Connections API</a> (part of <a href="http://developer.android.com/google/play-services/games.html">Google Play Game Services</a>) which handles callbacks, connection setup, sending/receiving messages, and disconnections/reconnections. It is written in C++ and uses the <a href="http://developers.google.com/games/services/downloads/">Google Play Games C++ SDK</a>.</p>
<h2>Overview</h2>
<p>The Nearby Connections API uses a series of callbacks to handle various events that occur, including device discovery, connection events, incoming messages, and errors. These callbacks can trigger at any time on different threads. When you are writing a game, you usually don't want to have to worry about the nitty-gritty of setting up a connection, synchronizing data across threads, structuring your callbacks properly, prompting the user, etc. This library handles all that for you; all you have to do is tell it what you want to do and call <b>Update()</b> every frame.</p>
<p>You can look at the GPGMultiplayer class in <code><a class="el" href="gpg__multiplayer_8h_source.html">gpg_multiplayer.h</a></code>.</p>
<h2>Initializing</h2>
<p>Initializing GPGMultiplayer is simple: all you need to do is instantiate it and call <b>Initialize()</b>. When you call Initialize, you pass in a <em>service id</em>, which is how NearbyConnections identifies your specific game's multiplayer connection and differentiates it from other games.</p>
<p>There are other optional bits of setup you can do before hosting or joining a game:</p>
<ul>
<li>Call <b>AddAppIdentifier()</b> to add an application identifier, which allows users who don't have your app installed to find it in Google Play.</li>
<li>Use <b>set_my_instance_name()</b> to change the name displayed in the prompt when you broadcast or connect to a game. By default this will be the device name.</li>
<li>On the host, use <b>set_max_players_allowed()</b> to set the maximum number of clients that are allowed to connect. The default is unlimited.</li>
<li>Set <b>set_auto_connect()</b> to <em>true</em> to enable automatically connecting without prompting the user. If you are hosting a game, this will automatically allow anyone to connect. If you are joining a game, this will automatically connect to the first game found.</li>
<li>Set <b>set_allow_reconnecting()</b> to <em>false</em> (it defaults to true) to disallow anyone who was disconnected from reconnecting (not recommended).</li>
</ul>
<p>After you have initialized GPGMultiplayer, you should ensure that you call <b>Update()</b> once per frame or the library will not operate correctly.</p>
<h2>Setting up a Connection</h2>
<p>There are two sides to every connection: one host, and one or more clients. The clients all connect to a host and can only send messages to the host; the host allows all the clients to connect and can send messages to any and all clients.</p>
<h3>Hosting a Game</h3>
<p>To host a game, call <b>StartAdvertising()</b>. This will begin advertising your game over the local Wi-Fi network. Any devices that are performing <em>discovery</em> will see your game and prompt the user to connect. If you have set auto_connect to true, the host will automatically accept connections; otherwise the user will be prompted.</p>
<p>You can check how many players are connected at any time by calling <b>GetNumConnectedPlayers()</b>. Once you are satisfied that you have enough players connected, simply call <b>StopAdvertising()</b> to stop allowing players to connect and start your game.</p>
<p>To abort hosting a game, call <b>ResetToIdle()</b> to disconnect all players and return to an idle state.</p>
<h3>Joining a Game</h3>
<p>To search for games to join, call <b>StartDiscovery()</b>. The game will automatically search for hosted games on the local Wi-Fi network, and if it finds one with the same service ID, it will automatically prompt the user to connect.</p>
<p>You can check to see if you are connected to a game by calling <b>IsConnected()</b>, which will return true if you successfully connected to a game.</p>
<p>To abort trying to connect, call <b>StopDiscovery()</b> or <b>ResetToIdle()</b> to return to an idle state.</p>
<h2>While Connected</h2>
<p>While connected, <b>IsConnected()</b> will return true. If it ever returns false, you have been disconnected and should show the user a message.</p>
<p>At any time you can call <b>is_hosting()</b> if you need to know whether you are the host or a client.</p>
<h3>On the Host</h3>
<p>While connected, you can send messages to other players and receive messages sent by other players.</p>
<p>Clients are identified by their <b>Instance ID</b>, which is a string unique for each player while the app is open. If you are the host, you can send messages to a specific Instance ID or broadcast them to all clients.</p>
<p>Clients also have a "Player Number" which corresponds to their connected player slot (counting up from 0). You can get a player's number from their instance ID or vice versa using <b>GetPlayerNumberByInstanceId()</b> or <b>GetInstanceIdByPlayerNumber()</b>.</p>
<p>If you want to disconnect a specific player, call <b>DisconnectInstance()</b>. You can disconnect all players by calling <b>DisconnectAll()</b> or <b>ResetToIdle()</b>.</p>
<p>Remember to call <b>Update()</b> every frame!</p>
<h4>Messages</h4>
<p>To send a message to one client, call <b>SendMessage()</b>, or to send message to all clients, call <b>BroadcastMessage()</b>. The message itself is an arbitrary binary blob, but we recommend using <a href="https://google.github.io/flatbuffers/">FlatBuffers</a> to structure, encode, and verify your multiplayer messages.</p>
<p>Incoming messages are placed in a queue. To check if you have any incoming messages available, call <b>HasMessage()</b>. If that returns true, you can call <b>GetNextMessage()</b> to get the next message from the queue (it will be consumed); you may have multiple messages, so you should keep getting and processing messages until HasMessage returns false.</p>
<p>When you receive a message, you will also receive the instance ID of the player who sent it; you can use <b>GetPlayerNumberByInstanceId()</b> to find out their player number.</p>
<h4>Reconnecting</h4>
<p>By default, if a client disconnects, the library will automatically give it a chance to reconnect and get its old player number back. Your game may want to know when this happens (so it can, for example, give the reconnected player a full update of the game state). You can see if any players have reconnected by calling <b>HasReconnectedPlayer()</b>, and if there are any, call <b>GetReconnectedPlayer()</b> to get their player number.</p>
<p>Similarly to the message queue, this consumes the reconnected player number, and you may have multiple reconnected players, so keep getting them until HasReconnectedPlayer returns false.</p>
<p>The list of disconnected clients who are allowed to reconnect is cleared whenever you call StartAdvertising or StartDiscovery to begin a new multiplayer session.</p>
<p>If a client has disconnected but you still have other clients connected, <b>IsConnected()</b> will still return true. You can find out if any clients are connected by calling <b>GetNumConnectedPlayers()</b>, or if a specific player has disconnected by calling <b>GetInstanceIdByPlayerNumber()</b> (a disconnected player will have a blank instance ID).</p>
<h3>On Clients</h3>
<p>While connected, you can send messages to the host and receive messages from the host.</p>
<p>You can disconnect from the host by using <b>DisconnectAll()</b> or <b>ResetToIdle()</b>.</p>
<p>If <b>IsConnected()</b> ever returns false, you have been disconnected from the host.</p>
<p>Remember to call <b>Update()</b> every frame!</p>
<h4>Messages</h4>
<p>Unlike the host, clients cannot communicate with arbitrary players, they can only communicate with the host itself. Call <b>BroadcastMessage()</b> on the client to send a message to the host; see above for details on the message contents.</p>
<p>Clients use the same <b>HasMessage()</b> / <b>GetNextMessage()</b> method of receiving incoming messages, although the instance ID will always be that of the host.</p>
<h2>Dependencies</h2>
<p>GPGMultiplayer uses a few Java methods via JNI to handle prompting the user for connection setup. If you have your own UI system you can replace these and remove the Java dependency entirely.</p>
<p><br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-49880327-7', 'google.github.io');
ga('send', 'pageview');
</script>
</body>
</html>
