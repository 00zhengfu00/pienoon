<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Pie Noon: Pie Noon GUI System</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,700" rel="stylesheet">
<link href="style.css" rel="stylesheet" type="text/css"/>
<script>
  /**
   * Check if the browser rendering this page is being run on an Android device.
   * It checks if the string 'android' is found in the browser's `userAgent`.
   * @return {boolean} This returns `true` if the browser's `userAgent` contains
   * the string 'android' (indicating that the browser is on an Android device).
   * Otherwise, it returns `false`.
   */
  function isAndroidDevice() {
    if (navigator && navigator.userAgent) {
      return navigator.userAgent.toLowerCase().indexOf('android') != -1;
    } else {
      return false;
    }
  }
  /**
   * Check if an HTML `class` attribute is in the browser-specific format.
   * @param {string} An HTML `class` attribute in the format 'browser-{device}'.
   * @return {boolean} Returns `true` if `browserClass` was in the valid format,
   * prefixed with 'browser-'. Otherwise, it returns false.
   */
  function isBrowserSpecificClassName(browserClass) {
    if (browserClass && browserClass.substring(0, 8) == 'browser-' &&
        browserClass.length > 8) {
      return true;
    } else {
      return false;
    }
  }
  /**
   * Get all the HTML Elements with browser-specific `class` attributes.
   * @return {array} Returns an array of all the HTML Elements with a `class`
   * attribute that is prefixed with `browser-`.
   */
  function getAllBrowserSpecificElements() {
    if (document) {
      var htmlElements = document.getElementsByTagName("*");
      var browserSpecificElements = [];
      for (var i = 0; i < htmlElements.length; i++) {
        if (isBrowserSpecificClassName(htmlElements[i].className)) {
          browserSpecificElements.push(htmlElements[i]);
        }
      }
      return browserSpecificElements;
    } else {
      return null;
    }
  }
  /**
   * Given a browser-specific HTML `class` attribute, extract the device name.
   * @param {string} browserClass The string name of an HTML `class` attribute,
   * in the format `browser-{device}`.
   * @return {string} Returns a string containing only the device portion of
   * the class name. If the input was invalid, then it returns `null`.
   */
  function extractDeviceFromBrowserClass(browserClass) {
    if (isBrowserSpecificClassName(browserClass)) {
      return browserClass.substring(8);
    }
    else {
      return null;
    }
  }
  /**
   * Hide device specific elements that do not apply to the current device.
   */
  function handleDeviceSpecificLoading() {
    var browserSpecificElements = getAllBrowserSpecificElements();
    for (var i = 0; i < browserSpecificElements.length; i++) {
      var device = extractDeviceFromBrowserClass(browserSpecificElements[i].className);
      if (device && !isAndroidDevice() && device == 'android') {
        browserSpecificElements[i].innerHTML = '';
      } else if(device && isAndroidDevice() && device == 'desktop') {
        browserSpecificElements[i].innerHTML = '';
      }
    }
  }
  $(document).ready(handleDeviceSpecificLoading);
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="commonprojectlogo">
    <img alt="Logo" src="fpl_logo_small.png"/>
  </td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Pie Noon
   </div>
   <div style="font-size:12px;">
	 An open source project by
     <a href="https://developers.google.com/games/#Tools">FPL</a>.
  </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pie_noon_guide_gameplay.html"><span>Gameplay</span></a></li>
      <li><a href="pie_noon_guide_overview.html"><span>Programmer's&#160;Guide</span></a></li>
      <li><a href="pie_noon_readme.html"><span>Readme</span></a></li>
      <li><a href="contributing.html"><span>Contributing</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('pie_noon_guide_gui.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Pie Noon GUI System </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="gui_introduction"></a>
Introduction</h1>
<p>This document outlines the GUI components used to construct the menus in Pie Noon.</p>
<h1><a class="anchor" id="gui_high_level_goals"></a>
High Level Goals</h1>
<p>The GUI menu system is designed to provide an easy way to author data-driven menus that automatically handle input from both touch devices and gamepads.</p>
<h1><a class="anchor" id="gui_organization"></a>
Organization</h1>
<p>Basic input is provided by the Input system (<code>input.h/cpp</code>). This provides access to raw input data such as key presses, joystick/gamepad movements, and mouse/pointer touch events.</p>
<p>The system is built upon the <code>TouchscreenButton</code> class, (<code>touchscreenbutton.cpp/h</code>) which represents an onscreen button which responds to touch events and can easily be queried to learn if it has been pushed recently. Each item in the menu is a <code>TouchscreenButton</code>.</p>
<p><code>TouchscreenButtons</code> can be used independently, but most collections of buttons in the game are written using <code>GuiMenus</code>, (<code>gui_menu.cpp/.h</code>) which are organizations of <code>TouchscreenButtons</code>, along with whatever static images are necessary to render the menu on screen.</p>
<p>The <code>GuiMenu</code> class takes care of updating and maintaining the <code>TouchScreenButtons</code>, as well as tracking the menu focus and handling movement and selection from gamepads/keyboards and other non-touch sources.</p>
<h1><a class="anchor" id="gui_touchscreenbuttons"></a>
TouchscreenButtons</h1>
<p>Each <code>TouchscreenButton</code> represents a single button on-screen. As long as something calls its <code>AdvanceFrame()</code> member function every frame, it will keep itself up to date, and track touch events. It can be queried via the <code>button()</code> member function, which returns an input button object, (a standard object in the <a class="el" href="pie_noon_guide_engine.html#engine_input">input</a> library, for tracking input states via <code>is_down()</code>, <code>went_down()</code>, and <code>went_up()</code>.) This is used to check both the current state of the button, as well as any changes that have taken place since the last update.</p>
<p>All of the details for each button are read in from a <a href="http://google.github.io/flatbuffers/">Flatbuffer</a> data object, <code>button_def</code>. (Located in <code>common.fbs/json</code>) This describes both the look of the button, (textures and offests to use when rendering the button when up/down), the screen-area that the button registers touches in, and a unique button ID.</p>
<h1><a class="anchor" id="gui_guimenu"></a>
GuiMenu</h1>
<p>The <code>GuiMenu</code> object represents a menu that the player can navigate using their keyboard or a gamepad. It maintains a list of active buttons that are part of the menu, handles transitions between them, and registers events if a menu item is selected via gamepad, or clicked with a touch device.</p>
<p>Any time a button is pressed the <code>GuiMenu</code> records this as an event, and stores it in a queue. The game can request the oldest unhandled menu selection event via the <code>GetRecentSelection()</code> funtion, and <code>handle</code> them accordingly. (Events are returned as a structure containing the ID of the button that was pressed, and the ID of the controller that completed the action.)</p>
<p>Much like <code>TouchscreenButton</code>s, <code>GuiMenus</code> are described by a <a href="http://google.github.io/flatbuffers/">Flatbuffer</a> data object, which lists all of the buttons in the current menu, as well as things like whether the buttons should respond to controller input or be touch only or which button should start out selected.</p>
<p>The game maintains one <code>GuiObject</code>, which simply loads up different menus when called for.</p>
<h1><a class="anchor" id="gui_staticimage"></a>
StaticImage</h1>
<p><code>GuiMenus</code> also contain static images - other art necessary for rendering the menu, but that is not interactive. Like other parts of the menu, static images are also loaded from the <a href="http://google.github.io/flatbuffers/">Flatbuffer</a> configuration file. Structurally, they are effectively buttons, stripped of most of their interactivity.</p>
<h1><a class="anchor" id="gui_menu_button_states"></a>
Menu Button States</h1>
<p>The <code>GuiMenu</code> allows for several possible states the buttons can be in at any given time. These states are tracked on the buttons, but largely only make sense in the context of the menu itself.</p>
<h2><a class="anchor" id="gui_menu_focus"></a>
Focus</h2>
<p>The focus is the button that is currently "selected" in the menu. It a gamepad user were to push the A button, whatever button currently has focus would trigger. Only one button can have focus at a time, and this is tracked by the menu itself. The game can check the current focus via the <code>GetFocus()</code> method.</p>
<p>When a button has focus, it will automatically animate and pulse.</p>
<h2><a class="anchor" id="gui_menu_disabled"></a>
Disabled</h2>
<p>When buttons are set to be disabled, they are greyed out, and cannot be selected. They can still receive focus, but if the user tries to select them, instead of a normal event being sent, they send an event of type <code>kInvalidInput</code>.</p>
<h2><a class="anchor" id="gui_menu_visible"></a>
Visible</h2>
<p>Buttons are normally visible, but this can be changed. If a button's visibility is set to false, then the button does not render on screen, and cannot receive focus or be selected. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-49880327-7', 'google.github.io');
ga('send', 'pageview');
</script>
</body>
</html>
